---
title: "Appendix B"
author: "Ben Weinstein"
date: "May 4, 2015"
output: html_document
---

```{r}
library(reshape2)
library(ggplot2)

#read in data from Abundance.Rmd
load("Abundance.Rdata")
```

Sampling intensity and detection for each hummingbird species
```{r}
head(tab)
```

The probability of missing a species at each daily visit is 1 - detection probability.

The probability of missing a species on sequential visits is (1- detection probability) * (1 - detection probability).

We are interested in the number of sampling events that minimize this value to some reasonable threshold. I have chosen 0.05 by convention. 

The following figure represesent the estimated number of daily surveys to capture a hummingbird event given that we know it occurs. These data can be thought of as successful draws from a negative binomial distribution.

It is easiest to interpret as the number of days until you are likely to see an interaction, so i prefer to calculate:

$$ 1-(1-p)^n $$
$$ p = probability of detection$$
$$ n = days sample $$

```{r,fig.width=12,fig.height=10}
dp<-function(n,p){
  1-((1-p)^n)
}

ts<-split(tab,tab$Hummingbird,drop=T)
detectd<-lapply(ts,function(x){
  meanD<-dp(n=1:25,p=x$mean/100)
  lowerD<-dp(n=1:25,p=x$lower/100)
  upperD<- dp(n=1:25,p=x$upper/100)
  data.frame(Days=1:25,mean=meanD,lower=lowerD,upper=upperD)
})

md<-melt(detectd,id.var="Days")
md<-dcast(md,...~variable)
ggplot(md,aes(x=Days,fill=L1,y=mean,ymin=lower,ymax=upper)) + geom_ribbon(alpha=.5) + geom_line() + facet_wrap(~L1) + geom_hline (yintercept=.5,linetype="dashed") + ylab("Probability of Detection") + scale_fill_discrete(guide="none") + theme_bw()
ggsave("Figures/AppendixB.jpeg",height=7,width=7,dpi=300)
```

The number of days it would take to have 50% confidence you have sampled enough to capture known interactions is the x axis value where the dotted line hits the curve.