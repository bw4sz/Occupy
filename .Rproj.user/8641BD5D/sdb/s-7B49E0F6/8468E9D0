{
    "contents" : "###############################################################################\n#Hummingbird Flower Interactions at the Santa Lucia and Maquipucuna EcoReserves\n###############################################################################\n#Ben Weinstein - Stony Brook University - Department of Ecology and Evolution\n\nlibrary(chron)\nlibrary(bipartite)\nlibrary(ggplot2)\nlibrary(ape)\nlibrary(reshape)\nlibrary(sna)\nlibrary(stringr)\nlibrary(maptools)\nlibrary(taxize)\nlibrary(picante)\nlibrary(dplyr)\nlibrary(scales)\n\n#Set Dropbox Location\n#setwd to dropbox\ndroppath<-\"C:/Users/Ben/Dropbox/\"\nsetwd(droppath)\n#Set github path\ngitpath<-\"C:/Users/Ben/Documents/Maquipicuna/\"\n\n#Read in data\n\n#bring in clade data\nclades<-read.csv(paste(gitpath,\"InputData//CladeList.txt\",sep=\"\"),header=FALSE)[,-1]\ncolnames(clades)<-c(\"Clade\",\"Genus\",\"Species\",\"double\",\"English\")\nclades<-clades[,1:5]\n\n#Bring in the hummingbird phylogeny\ntree<-read.nexus(paste(gitpath,\"InputData/ColombiaPhylogenyUM.tre\",sep=\"\"))\n\n#Read in names file to replace names in Nexis file\nspnames<-read.table(paste(gitpath,\"InputData/SpNameTree.txt\",sep=\"\") , sep = \"\\t\", header = TRUE)\n\n#Replace tip.label with Spnames#\ntree$tip.label<-as.character(spnames$SpName) \n\n#Read in trait distance between species, run from Morphology.R\nsp.dist<-read.csv(\"Thesis/Maquipucuna_SantaLucia/Results/HummingbirdDist.csv\",row.names=1)\n\n#Read in plant phylogeny \npco<-read.csv(paste(gitpath,\"InputData/PlantRelatedness.csv\",sep=\"\"))\n\n###Read in Flower Camera Dataset####\ndat<-read.csv(\"Thesis/Maquipucuna_SantaLucia/Data2013/csv/FlowerVideoClean.csv\",row.names=1)\n\n#Get desired columns\n#dat<-dat[,colnames(dat) %in% c(\"ID\",\"Video\",\"Date\",\"Iplant_Double\",\"Time\",\"Hummingbird\",\"Sex\",\"Temp\",\"Pierce\",\"lon\",\"lat\",\"ele\")]\n\n#Fix date format\ndat$Month<-as.numeric(format(as.Date(dat$Date,\"%m/%d/%Y\"),\"%m\"))\n\n####Bring in interaction matrix for the flower transects, see FlowerTransects.R\ntransect.FL<-read.csv(\"Thesis/Maquipucuna_SantaLucia/Results/HummingbirdTransects/HumTransectRows.csv\",row.names=1)\n\n#make the columns as similiar as possible to videodata\ncolnames(transect.FL)<-c(\"GPS.ID\",\"TransectID\",\"Hummingbird\",\"Date\",\"Month\",\"Transect_R\",\"Iplant_Double\",\"lat\",\"lon\",\"ele\")\n\ntransect.FL$Iplant_Double<-gsub(\"_\",\" \",transect.FL$Iplant_Double)\n\n#Bind in the transect rows to the bottom of dat?\ndat<-rbind_all(list(dat,transect.FL))\n\ndat$Iplant_Double<-as.factor(dat$Iplant_Double)\n\ndat<-as.data.frame(dat)\n############################################\n#Create Universal Date Stamp\n\ndat$DateP<-sapply(dat$Date,function(x){\n  if(is.na(x)){\n    return(NA)\n  }\n  if(str_detect(x,\"-\")){\n    toR<-as.character(strptime(x,\"%Y-%m-%d\"))\n    #print(toR)\n    return(toR)\n  }\n  \n  if(str_detect(x,\"/\")){\n    toR<-as.character(strptime(x,format=\"%m/%d/%Y\"))\n    #print(toR)\n    return(toR)\n  }\n})\n\n#which are NA?\n#Known date errors\ndat[is.na(dat$DateP),]\ndat$DateP[is.na(dat$DateP) & dat$ID==\"FL080\"]<-c(\"2013-07-25\")\n\ndat$DateP<-as.POSIXlt(dat$DateP)\n\nhead(dat)\n\n#Mistakenly labeled 2012\ndat[dat$Date %in% \"6/4/2012\",\"DateP\"]<-\"2013-06-04\"\n\n###########################\n#Hummingbird Data Cleaning \n###########################\n.simpleCap <- function(x) {\n  s <- strsplit(x, \" \")[[1]]\n  paste(toupper(substring(s, 1, 1)), substring(s, 2),\n        sep = \"\", collapse = \" \")\n}\n\n#Caps Hummingbird\ndat$Hummingbird<-factor(sapply(dat$Hummingbird,function(x) {.simpleCap(as.character(x))}))\n\n#make a object, just to save typing\nh<-levels(dat$Hummingbird)\n\nmissp<-h[!h %in% clades$English]\n\npaste(\"misspelled levels\",missp)\n\n#correct levels\nh[h %in% \"Booted Racketail\"]<-\"Booted Racket-tail\"\nh[h %in% \"Violet-tailed Slyph\"]<-\"Violet-tailed Sylph\"\nh[h %in% \"VIolet-tailed Slyph\"]<-\"Violet-tailed Sylph\"\n\nh[h %in% \"Ukwn\"]<-\"UKWN\"\nh[h %in% \"Green-crowned Woodnymph\"]<-\"Crowned Woodnymph\"\nh[h %in% \"Western Emerald\"]<-\"Crowned Woodnymph\"\n\nlevels(dat$Hummingbird) <- h\ndat<-droplevels(dat)\n\n#Take our any bad data\ndat_e<-droplevels(dat[!dat$Hummingbird %in% c(\"\",\"NANA\",\"UKWN\",\"Ukwn\"),])\n\n#Remove out piercing events for now?\n#table(dat$Pierce)\n#datPierce<-dat_e[dat_e$Piercing %in% c(\"Yes\",\"YES\",\"y\",\"Y\"),]\n#dat_e<-dat_e[!dat_e$Pierce %in% c(\"Yes\",\"YES\",\"y\",\"Y\"),]\n\n#Drop any unused factors?\ndat_e<-droplevels(dat_e)\n\n#Drop any observations without plants\ndat_e$Iplant_Double<-as.character(dat_e$Iplant_Double)\ndatinter<-dat_e[!dat_e$Iplant_Double %in% \"\",]\n\n\nsp_l<-unique(datinter$Iplant_Double)\n\nl<-sapply(sp_l,function(x){\n  str2 <- gsub(' {2,}',' ',x)\n  length(strsplit(str2,' ')[[1]])\n})\n\nsp_r<-names(which(l==1))\n\n\ndatinter<-droplevels(datinter[!datinter$Iplant_Double %in% sp_r,])\n#################Data Cleaning Complete################\n\n#make sure capitalize\nGenus<-paste(toupper(substring(word(datinter$Iplant_Double),1,1)),substring(word(datinter$Iplant_Double),2),sep=\"\")\nSpecies<-tolower(word(datinter$Iplant_Double,2))\ndatinter$Iplant_Double<-paste(Genus,Species,sep=\" \")\n\n#Taxonomic changes\ndatinter[datinter$Iplant_Double %in% \"Heliconia griggsianna\",\"Iplant_Double\"]<-\"Heliconia griggsiana\"\n\ndatinter[datinter$Iplant_Double==\"Alloplectus purpureus\",\"Iplant_Double\"]<-\"Glossoloma purpureum\"\ndatinter[datinter$Iplant_Double==\"Capanea affinis\",\"Iplant_Double\"]<-\"Kohleria affinis\"\ndatinter[datinter$Iplant_Double==\"Columnea cinerea\",\"Iplant_Double\"]<-\"Columnea mastersonii\"\ndatinter[datinter$Iplant_Double==\"Alloplectus teuscheri\",\"Iplant_Double\"]<-\"Drymonia teuscheri\"\n\ndatinter$Hummingbird<-as.character(datinter$Hummingbird)\ndatinter$Hummingbird[datinter$Hummingbird %in% \"Green-crowned Woodnymph\"]<-\"Crowned Woodnymph\"\n\n#Final levels\nprint(paste(\"Final Flower Species:\", levels(factor(datinter$Iplant_Double))))\n\n#How many Birds Species\n#print(paste(\"Number of Hummingbird Species:\",nlevels(datinter$Hummingbird)))\n#print(paste(\"Final Hummingbird Species:\",levels(datinter$Hummingbird)))\n\n#Known elevation ranges\ndatinter$Hummingbird[datinter$Hummingbird %in% \"Green-crowned Woodnymph\"]<-\"Crowned Woodnymph\"\n\n#A couple cameras have duplicate names, probably karen and I putting cameras up the same day.\ndatinter$ID<-as.character(datinter$ID)\ndatinter %>% select(-DateP) %>% group_by(ID) %>% dplyr::summarize(l=length(unique(Iplant_Double)))%>% arrange(desc(l))\ndatinter$ID<-as.character(datinter$ID)\n\ndatinter[datinter$ID %in% \"FL078\" & datinter$DateP ==\"2013-07-25\",\"ID\"]<-\"FL078A\"\ndatinter[datinter$ID %in% \"FL094\"& datinter$Iplant_Double ==\"Besleria solanoides\",\"ID\"]<-\"FL094A\"\ndatinter[datinter$ID %in% \"NF027\" & datinter$Iplant_Double ==\"Columnea mastersonii\",\"ID\"]<-\"NF027A\"\ndatinter[datinter$ID %in% \"NF2\" & datinter$DateP %in% '2013-11-06',\"ID\"]<-\"NF2A\"\ndatinter[datinter$ID %in% \"NF126\"& datinter$DateP %in% '2014-09-21',\"ID\"]<-\"NF126A\"\n\n\n#Checking the original data, one interaction Booted Racket-tail and Guzmania amplectens is labeled 'heard only' and seems extremely unlikely, removed.\ndatinter<-datinter[!(datinter$Hummingbird %in% \"Booted Racket-tail\" & datinter$Iplant_Double %in% \"Guzmania amplectens\"),]\n\n\n#Write to file.\nwrite.csv(datinter,\"Thesis/Maquipucuna_SantaLucia/Results/Network/HummingbirdInteractions.csv\")\n\n#print(\"data cleaned\")\n\n##Elevation Plots\n\n#Overall Month_Day and Elevation\np<-ggplot(datinter,aes(y=ele,x=DateP)) + geom_point(size=3) + facet_wrap(~Hummingbird,scales=\"free\")\np<-p + scale_x_datetime(breaks = date_breaks(\"3 months\"),labels = date_format(\"%b\")) + scale_y_continuous(breaks=seq(1300,2500,200),labels=seq(1300,2500,200)) + xlab(\"Month\") + ylab(\"Elevation(m)\")\np + stat_smooth()\n#ggsave(\"Thesis//Maquipucuna_SantaLucia/Results/DateElevation.jpeg\",height=10,width=17,dpi=350)\n#ggsave(\"Thesis//Maquipucuna_SantaLucia/Results/DateElevation.svg\",height=8,width=13,dpi=300)\n\n#\n#Boxplot of elevation ranges\n#add # of observations for each\nkeep<-names(which(table(datinter$Hummingbird) > 5))\n\ndatinter<-datinter[datinter$Hummingbird %in% keep,]\n\nobs<-as.data.frame.array(table(datinter$Hummingbird))\n\n#order \nhumord<-datinter%>% dplyr::select(Hummingbird,ele)%>% group_by(Hummingbird) %>% dplyr::summarize(m=mean(ele,na.rm=T)) %>% arrange(m) %>% select(Hummingbird) \ndatinter$Hummingbird<-factor(datinter$Hummingbird,levels=humord$Hummingbird)\np<-ggplot(datinter,aes(y=ele,x=Hummingbird,fill=Hummingbird)) + ylim(1300,2600)\np<-p + geom_boxplot(varwidth=TRUE) + coord_flip() + labs(y=\"Elevation(m)\",x=\"\") + scale_fill_discrete(guide='none') + theme_bw()\nprint(p)\nggsave(\"Thesis//Maquipucuna_SantaLucia/Results/ElevationRanges.jpg\",dpi=600,height=7,width=10)\n\n#defined elevation groups for occupancy model\neleIndex<-datinter[,!colnames(datinter) %in% c(\"Date_F\",\"DateP\")] %>% group_by(Hummingbird) %>% summarize(Low=quantile(ele,0.25,na.rm=T),m=mean(ele,na.rm=T),High=quantile(ele,0.75,na.rm=T))\n\n#1 for low elevation, 2 for high elevation, 3 for both\n#high elevation\neleIndex[eleIndex$Low > 1800,\"Index\"]<-2\n\n#low elevation\neleIndex[eleIndex$High < 1800,\"Index\"]<-1\n\n#The result are both\neleIndex[is.na(eleIndex$Index),\"Index\"]<-3\n\n#Crowned woodnymph have a few wanders, but are certainly low elevation, opposite with Buff-tailed Coronet\neleIndex[eleIndex$Hummingbird %in% \"Crowned Woodnymph\",\"Index\"]<-1\neleIndex[eleIndex$Hummingbird %in% \"Buff-tailed Coronet\",\"Index\"]<-2\n\n#view result\nas.data.frame(eleIndex)\n\nwrite.csv(eleIndex,paste(gitpath,\"OutData/HummingbirdElevation.csv\",sep=\"\"))\n",
    "created" : 1460560629602.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3830244678",
    "id" : "8468E9D0",
    "lastKnownWriteTime" : 1460560733,
    "path" : "~/Maquipicuna/Interactions.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 6,
    "source_on_save" : false,
    "type" : "r_source"
}