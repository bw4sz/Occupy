castdf<-dcast(parsObs[parsObs$par %in% c("beta1_mu","alpha_mu","tauE"),], Model+Chain + Draw~par,value.var="estimate")
library(reshape2)
library(chron)
library(ggplot2)
library(knitr)
library(R2jags)
library(dplyr)
library(stringr)
library(gridExtra)
library(boot)
library(bipartite)
opts_chunk$set(message=FALSE,warning=FALSE,fig.width=10,fig.height=7,echo=TRUE,cache=F,fig.align='center',fig.path="figureObserved/")
source("Bayesian/BayesFunctions.R")
castdf<-dcast(parsObs[parsObs$par %in% c("beta1_mu","alpha_mu","tauE"),], Model+Chain + Draw~par,value.var="estimate")
castdf<-split(castdf,castdf$Model)
predy<-rbind_all(lapply(castdf,function(i){
#calculate trajectory and append model
pr<-trajF(alpha=i$alpha_mu,beta1=i$beta1_mu,tauSigma=1/sqrt(i$tauE),trait=indat$Traitmatch,resources=indat$scaledR)
pr$Model<-unique(i$Model)
return(pr)
}))
unique(predy$Model)
fplot<-ggplot(data=predy[predy$Model %in% "N-mixture: Traits",],aes(x=trait)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=Model),alpha=0.5)  + geom_line(aes(y=mean,col=Model),size=.4) + theme_bw() + ylab("Daily Interactions") + xlab("Difference between Bill and Corolla Length (cm)") + geom_point(data=indat,aes(x=Traitmatch,y=Yobs),size=.5,alpha=1) + labs(fill="Model",col="Model")  + scale_fill_manual(values=c("grey70","black"))+ scale_color_manual(values=c("grey70","black"))
fplot
ggsave("Figures/JustNmixture.jpg",heigh=5,width=7,dpi=300)
castdf<-dcast(parsObs[parsObs$par %in% c("beta1","alpha"),], species +Chain +Model+ Draw~par,value.var="estimate")
tcastdf<-dcast(parsObs[parsObs$par %in% c("tauE"),],  Chain +Model+ Draw~par,value.var="estimate")
castdf<-merge(castdf,tcastdf,by=c("Chain","Model","Draw"))
#Turn to species level
castdf$species<-factor(castdf$species,levels=1:max(as.numeric(castdf$species)))
species.split<-split(castdf,list(castdf$species,castdf$Model),drop=T)
species.traj<-list()
for(d in 1:length(species.split)){
x<-species.split[[d]]
#species name
index<-jagsIndexBird[unique(x$species),"Hummingbird"]
#range of trait distances
tsp<-indat %>% filter(Hummingbird==index) %>% .$Traitmatch
#Range of abundances
fsp<-indat %>% filter(Hummingbird==index) %>% .$scaledR
species.traj[[d]]<-trajF(alpha=x$alpha,beta1=x$beta1,tauSigma=1/sqrt(x$tauE),trait=tsp,resources=fsp)
}
names(species.traj)<-names(species.split)
species.traj<-melt(species.traj,id.var=colnames(species.traj[[1]]))
#split out names and model
species.traj[,c("Index","Model")]<-colsplit(species.traj$L1,"\\.",c("Index","Model"))
spe<-merge(species.traj,jagsIndexBird,by.x="Index",by.y="jBird")
ggplot(data=spe[spe$Model %in% "N-mixture: Traits",],aes(x=trait)) + geom_point(data=indat,aes(x=Traitmatch,y=Yobs)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=Model),alpha=0.6)  + geom_line(aes(y=mean,col=Model),size=1) + theme_bw() + ylab("Interactions") + xlab("Difference between Bill and Corolla Length (cm)") + facet_wrap(~Hummingbird,scales="free",ncol=4)+ labs(fill="Model")  + ylab("Interactions per day") + scale_color_manual(values=c("grey70","black")) + scale_fill_manual(values=c("grey70","black"))
ggsave("Figures/JustNmixtureSpecies.jpg",heigh=5,width=7,dpi=300)
ggsave("Figures/JustNmixtureSpecies.jpg",heigh=8,width=9,dpi=300)
hord
ord
spe$Hummingbird<-factpr(spe$Hummingbird,levels=ord)
spe$Hummingbird<-factor(spe$Hummingbird,levels=ord)
ggplot(data=spe[spe$Model %in% "N-mixture: Traits",],aes(x=trait)) + geom_point(data=indat,aes(x=Traitmatch,y=Yobs)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=Model),alpha=0.6)  + geom_line(aes(y=mean,col=Model),size=1) + theme_bw() + ylab("Interactions") + xlab("Difference between Bill and Corolla Length (cm)") + facet_wrap(~Hummingbird,scales="free",ncol=4)+ labs(fill="Model")  + ylab("Interactions per day") + scale_color_manual(values=c("grey70","black")) + scale_fill_manual(values=c("grey70","black"))
ggsave("Figures/JustNmixtureSpecies.jpg",heigh=8,width=9,dpi=300)
?rmultinom
library(bipartite)
?rmultinom
rmultinom(1,10,0.5)
rmultinom(1,10,0.5)
rmultinom(1,10,0.5)
rmultinom(100,10,0.5)
rmultinom(100,10,0.5)
library(reshape2)
library(foreach)
library(chron)
library(ggplot2)
library(knitr)
library(R2jags)
library(dplyr)
library(stringr)
library(gridExtra)
library(boot)
opts_chunk$set(message=FALSE,warning=FALSE,fig.width=5,fig.height=4,echo=TRUE,cache=F,fig.align='center',fig.path="figure/")
set.seed(3)
load("AbundanceSimulation.RData")
tplot
tplot<-ggplot(data=pm[,],aes(x=trait)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=L1),alpha=0.5)  + geom_line(aes(y=mean,col=L1),size=.4,linetype="dashed") + theme_bw() + ylab("Daily Interactions") + xlab("Difference between Bill and Corolla Length") + geom_point(data=mdat,aes(x=traitmatch,y=Interactions),size=.5,alpha=.5) + labs(fill="Model",col="Model") + ggtitle("Simulation: Traits") + geom_line(data=orig,aes(y=mean,col='black'),size=.8) + scale_fill_manual(values=c("grey70","Black"))+ scale_color_manual(values=c("grey70","Black"))
tplot
tplot<-ggplot(data=pm[,],aes(x=trait)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=L1),alpha=0.5)  + geom_line(aes(y=mean,col=L1),size=.4,linetype="dashed") + theme_bw() + ylab("Daily Interactions") + xlab("Difference between Bill and Corolla Length") + geom_point(data=mdat,aes(x=traitmatch,y=Interactions),size=.5,alpha=.5) + labs(fill="Model",col="Model") + ggtitle("Simulation: Traits") + scale_fill_manual(values=c("grey70","Black"))+ scale_color_manual(values=c("grey70","Black"))+ geom_line(data=orig,aes(y=mean,col='black'),size=.8)
tplot
tplot<-ggplot(data=pm[,],aes(x=trait)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=L1),alpha=0.5)  + geom_line(aes(y=mean,col=L1),size=.4,linetype="dashed") + theme_bw() + ylab("Daily Interactions") + xlab("Difference between Bill and Corolla Length") + geom_point(data=mdat,aes(x=traitmatch,y=Interactions),size=.5,alpha=.5) + labs(fill="Model",col="Model") + ggtitle("Simulation: Traits") + scale_fill_manual(values=c("grey70","Black"))+ scale_color_manual(values=c("grey70","Black"))
tplot
tplot<-ggplot(data=pm[,],aes(x=trait)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=L1),alpha=0.5)  + geom_line(aes(y=mean,col=L1),size=.4,linetype="dashed") + theme_bw() + ylab("Daily Interactions") + xlab("Difference between Bill and Corolla Length") + geom_point(data=mdat,aes(x=traitmatch,y=Interactions),size=.5,alpha=.5) + labs(fill="Model",col="Model") + ggtitle("Simulation: Traits") + scale_fill_manual(values=c("grey70","Black"))+ scale_color_manual(values=c("grey70","Black"))+ geom_line(data=orig,aes(y=mean,col='black'),size=.8)
tplot
tplot<-ggplot(data=pm[,],aes(x=trait)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=L1),alpha=0.5)  + geom_line(aes(y=mean,col=L1),size=.4,linetype="dashed") + theme_bw() + ylab("Daily Interactions") + xlab("Difference between Bill and Corolla Length") + geom_point(data=mdat,aes(x=traitmatch,y=Interactions),size=.5,alpha=.5) + labs(fill="Model",col="Model") + ggtitle("Simulation: Traits") + scale_fill_manual(values=c("grey70","Black"))+ scale_color_manual(values=c("grey70","Black","Black"))+ geom_line(data=orig,aes(y=mean,col='black'),size=.8)
tplot
tplot<-ggplot(data=pm[,],aes(x=trait)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=L1),alpha=0.5)  + geom_line(aes(y=mean,col=L1),size=.4,linetype="dashed") + theme_bw() + ylab("Daily Interactions") + xlab("Difference between Bill and Corolla Length") + geom_point(data=mdat,aes(x=traitmatch,y=Interactions),size=.5,alpha=.5) + labs(fill="Model",col="Model") + ggtitle("Simulation: Traits") + scale_fill_manual(values=c("grey70","Black"))+ scale_color_manual(values=c("grey70","Black","Black"))+ geom_line(data=orig,aes(y=mean,col='black'),size=.8)
tplot
tplot<-ggplot(data=pm[,],aes(x=trait)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=L1),alpha=0.5)  + geom_line(aes(y=mean,col=L1),size=.4,linetype="dashed") + theme_bw() + ylab("Daily Interactions") + xlab("Difference between Bill and Corolla Length") + geom_point(data=mdat,aes(x=traitmatch,y=Interactions),size=.5,alpha=.5) + labs(fill="Model",col="Model") + ggtitle("Simulation: Traits") + scale_fill_manual(values=c("grey70","Black"))+ scale_color_manual("True value",values=c("grey70","Black","Black"))+ geom_line(data=orig,aes(y=mean,col='black'),size=.8)
tplot
tplot<-ggplot(data=pm[,],aes(x=trait)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=L1),alpha=0.5)  + geom_line(aes(y=mean,col=L1),size=.4,linetype="dashed") + theme_bw() + ylab("Daily Interactions") + xlab("Difference between Bill and Corolla Length") + geom_point(data=mdat,aes(x=traitmatch,y=Interactions),size=.5,alpha=.5) + labs(fill="Model",col="Model") + ggtitle("Simulation: Traits") + scale_fill_manual(values=c("grey70","Black"))+ scale_color_manual("True value",values=c("grey70","Black","Black"))+ geom_line(data=orig,aes(y=mean,col='Black'),size=.8)
tplot<-ggplot(data=pm[,],aes(x=trait)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=L1),alpha=0.5)  + geom_line(aes(y=mean,col=L1),size=.4,linetype="dashed") + theme_bw() + ylab("Daily Interactions") + xlab("Difference between Bill and Corolla Length") + geom_point(data=mdat,aes(x=traitmatch,y=Interactions),size=.5,alpha=.5) + labs(fill="Model",col="Model") + ggtitle("Simulation: Traits") + scale_fill_manual(values=c("grey70","Black"))+ scale_color_manual("True value",values=c("Black","grey70","Black"))+ geom_line(data=orig,aes(y=mean,col='Black'),size=.8)
tplot
tplot<-ggplot(data=pm[,],aes(x=trait)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=L1),alpha=0.5)  + geom_line(aes(y=mean,col=L1),size=.4,linetype="dashed") + theme_bw() + ylab("Daily Interactions") + xlab("Difference between Bill and Corolla Length") + geom_point(data=mdat,aes(x=traitmatch,y=Interactions),size=.5,alpha=.5) + labs(fill="Model",col="Model") + ggtitle("Simulation: Traits") + scale_fill_manual(values=c("grey70","Black"))+ scale_color_manual("",values=c("Black","grey70","Black"))+ geom_line(data=orig,aes(y=mean,col='True value'),size=.8)
tplot
ggsave("Figures/SimPredictBoth.svg",height=5,width=7)
tplot<-ggplot(data=pm[,],aes(x=trait)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=L1),alpha=0.5)  + geom_line(aes(y=mean,col=L1),size=.4,linetype="dashed") + theme_bw() + ylab("Daily Interactions") + xlab("Difference between Bill and Corolla Length") + geom_point(data=mdat,aes(x=traitmatch,y=Interactions),size=.5,alpha=.5) + labs(fill="Model",col="Model") + ggtitle("Simulation: Traits") + scale_fill_manual(values=c("grey70","Black"))+ scale_color_manual("",values=c("Black","grey70","Black"))+ geom_line(data=orig,aes(y=mean,col='True value'),size=.8)
tplot
tplot<-ggplot(data=pm[,],aes(x=trait)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=L1),alpha=0.5)  + geom_line(aes(y=mean),size=.4,linetype="dashed") + theme_bw() + ylab("Daily Interactions") + xlab("Difference between Bill and Corolla Length") + geom_point(data=mdat,aes(x=traitmatch,y=Interactions),size=.5,alpha=.5) + labs(fill="Model",col="Model") + ggtitle("Simulation: Traits") + scale_fill_manual(values=c("grey70","Black"))+ scale_color_manual("",values=c("Black","grey70","Black"))+ geom_line(data=orig,aes(y=mean,col='True value'),size=.8)
tplot<-ggplot(data=pm[,],aes(x=trait)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=L1),alpha=0.5)  + geom_line(aes(y=mean),size=.4,linetype="dashed") + theme_bw() + ylab("Daily Interactions") + xlab("Difference between Bill and Corolla Length") + geom_point(data=mdat,aes(x=traitmatch,y=Interactions),size=.5,alpha=.5) + labs(fill="Model",col="Model") + ggtitle("Simulation: Traits") + scale_fill_manual(values=c("grey70","Black"))+  geom_line(data=orig,aes(y=mean,col='True value'),size=.8)
tplot
tplot<-ggplot(data=pm[,],aes(x=trait)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=L1),alpha=0.5)  + geom_line(aes(y=mean,group=L1),size=.4,linetype="dashed") + theme_bw() + ylab("Daily Interactions") + xlab("Difference between Bill and Corolla Length") + geom_point(data=mdat,aes(x=traitmatch,y=Interactions),size=.5,alpha=.5) + labs(fill="Model",col="Model") + ggtitle("Simulation: Traits") + scale_fill_manual(values=c("grey70","Black"))+  geom_line(data=orig,aes(y=mean,col='True value'),size=.8)
tplot
tplot<-ggplot(data=pm[,],aes(x=trait)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=L1),alpha=0.5)  + geom_line(aes(y=mean,group=L1),size=.4,linetype="dashed") + theme_bw() + ylab("Daily Interactions") + xlab("Difference between Bill and Corolla Length") + geom_point(data=mdat,aes(x=traitmatch,y=Interactions),size=.5,alpha=.5) + labs(fill="Model",col="") + ggtitle("Simulation: Traits") + scale_fill_manual(values=c("grey70","Black"))+  geom_line(data=orig,aes(y=mean,col='True value'),size=.8)
tplot
tplot<-ggplot(data=pm[,],aes(x=trait)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=L1),alpha=0.5)  + geom_line(aes(y=mean,group=L1),size=.4,linetype="dashed") + theme_bw() + ylab("Daily Interactions") + xlab("Difference between Bill and Corolla Length") + geom_point(data=mdat,aes(x=traitmatch,y=Interactions),size=.5,alpha=.5) + labs(fill="Model",col="") + ggtitle("Simulation: Traits") + scale_fill_manual(values=c("grey70","Black"))+  geom_line(data=orig,aes(y=mean,col='True value'),col="black",size=.8)
tplot
tplot<-ggplot(data=pm[,],aes(x=trait)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=L1),alpha=0.5)  + geom_line(aes(y=mean,group=L1),size=.4,linetype="dashed") + theme_bw() + ylab("Daily Interactions") + xlab("Difference between Bill and Corolla Length") + geom_point(data=mdat,aes(x=traitmatch,y=Interactions),size=.5,alpha=.5) + labs(fill="Model",col="") + ggtitle("Simulation: Traits") + scale_fill_manual(values=c("grey70","Black"))+  geom_line(data=orig,aes(y=mean,col='True value'),size=.8)+ scale_color_manual(values="Black")
tplot
ggsave("Figures/SimPredictBoth.jpg",height=5,width=7)
library(reshape2)
library(chron)
library(ggplot2)
library(knitr)
library(R2jags)
library(dplyr)
library(stringr)
library(gridExtra)
library(boot)
library(bipartite)
opts_chunk$set(message=FALSE,warning=FALSE,fig.width=10,fig.height=7,echo=TRUE,cache=F,fig.align='center',fig.path="figureObserved/")
source("Bayesian/BayesFunctions.R")
load("Observed.Rdata")
ggplot(data=spe[,],aes(x=trait)) + geom_point(data=indat,aes(x=Traitmatch,y=Yobs)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=Model),alpha=0.6)  + geom_line(aes(y=mean,col=Model),size=1) + theme_bw() + ylab("Interactions") + xlab("Difference between Bill and Corolla Length (cm)") + facet_wrap(~Hummingbird,scales="free",ncol=4)+ labs(fill="Model")  + ylab("Interactions per day") + scale_color_manual(values=c("grey70","black")) + scale_fill_manual(values=c("grey70","black"))
ggplot(par_at,aes(x=estimate,fill=L1)) + geom_histogram() + ggtitle("Posterior Distribution") + theme_bw() + facet_wrap(~Hummingbird,ncol=5) + xlab("Probability of Detection")
fplot
ggplot(md) + geom_ribbon(aes(x=Days,y=mean,ymin=lower,ymax=upper)) + geom_line(aes(x=Days,fill=L1,y=mean,ymin=lower,ymax=upper)) + facet_wrap(~L1,nrow=4,scale="free_x")  + ylab("Probability of detecting a interaction") + scale_fill_discrete(guide="none") + theme_bw() + scale_x_continuous(breaks=seq(0,8,2),limits=c(0,8))+ geom_rect(fill='grey',data=daydf,alpha=0.4,aes(xmax=upper,xmin=lower,ymin=0,ymax=Inf)) + ylim(0,1)
ggplot(md) + geom_ribbon(aes(x=Days,y=mean,ymin=lower,ymax=upper)) + geom_line(aes(x=Days,fill=L1,y=mean,ymin=lower,ymax=upper)) + facet_wrap(~L1,nrow=4,scale="free_x")  + ylab("Probability of detecting a interaction") + scale_fill_discrete(guide="none") + theme_bw() + scale_x_continuous(breaks=seq(0,8,2),limits=c(0,8))+ geom_rect(fill='red',data=daydf,alpha=0.4,aes(xmax=upper,xmin=lower,ymin=0,ymax=Inf)) + ylim(0,1)
ggsave("Figures/DetectionDays.jpeg",height=7,width=11,dpi=300)
castdf<-dcast(parsObs[parsObs$par %in% c("beta1","alpha"),], species +Chain +Model+ Draw~par,value.var="estimate")
tcastdf<-dcast(parsObs[parsObs$par %in% c("tauE"),],  Chain +Model+ Draw~par,value.var="estimate")
castdf<-merge(castdf,tcastdf,by=c("Chain","Model","Draw"))
#Turn to species level
castdf$species<-factor(castdf$species,levels=1:max(as.numeric(castdf$species)))
species.split<-split(castdf,list(castdf$species,castdf$Model),drop=T)
species.traj<-list()
for(d in 1:length(species.split)){
x<-species.split[[d]]
#species name
index<-jagsIndexBird[unique(x$species),"Hummingbird"]
#range of trait distances
tsp<-indat %>% filter(Hummingbird==index) %>% .$Traitmatch
#Range of abundances
fsp<-indat %>% filter(Hummingbird==index) %>% .$scaledR
species.traj[[d]]<-trajF(alpha=x$alpha,beta1=x$beta1,tauSigma=1/sqrt(x$tauE),trait=tsp,resources=fsp)
}
names(species.traj)<-names(species.split)
species.traj<-melt(species.traj,id.var=colnames(species.traj[[1]]))
#split out names and model
species.traj[,c("Index","Model")]<-colsplit(species.traj$L1,"\\.",c("Index","Model"))
spe<-merge(species.traj,jagsIndexBird,by.x="Index",by.y="jBird")
#match colnames
#plot and compare to original data
ggplot(data=spe[,],aes(x=trait)) + geom_point(data=indat,aes(x=Traitmatch,y=Yobs)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=Model),alpha=0.6)  + geom_line(aes(y=mean,col=Model),size=1) + theme_bw() + ylab("Interactions") + xlab("Difference between Bill and Corolla Length (cm)") + facet_wrap(~Hummingbird,scales="free",ncol=4)+ labs(fill="Model")  + ylab("Interactions per day") + scale_color_manual(values=c("grey70","black")) + scale_fill_manual(values=c("grey70","black"))
ggsave("Figures/SpeciesPredictionsBoth.jpg",dpi=300,height=9,width=11)
ggplot(data=spe[,],aes(x=trait)) + geom_point(data=indat,aes(x=Traitmatch,y=Yobs)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=Model),alpha=0.6)  + geom_line(aes(y=mean,col=Model),size=1) + theme_bw() + ylab("Interactions") + xlab("Difference between Bill and Corolla Length (cm)") + facet_wrap(~Hummingbird,scales="free",ncol=4)+ labs(fill="Model")  + ylab("Interactions per day") + scale_color_manual(values=c("red","teal")) + scale_fill_manual(values=c("red","teal"))
ggsave("Figures/SpeciesPredictionsBoth.jpg",dpi=300,height=9,width=11)
ggplot(data=spe[,],aes(x=trait)) + geom_point(data=indat,aes(x=Traitmatch,y=Yobs)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=Model),alpha=0.6)  + geom_line(aes(y=mean,col=Model),size=1) + theme_bw() + ylab("Interactions") + xlab("Difference between Bill and Corolla Length (cm)") + facet_wrap(~Hummingbird,scales="free",ncol=4)+ labs(fill="Model")  + ylab("Interactions per day") + scale_color_manual(values=c("red","lightblue")) + scale_fill_manual(values=c("red","lightblue"))
head(spe)
ggplot(data=spe[,],aes(x=trait)) + geom_point(data=indat,aes(x=Traitmatch,y=Yobs)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=Model),alpha=0.6)  + geom_line(aes(y=mean,col=Model),size=1) + theme_bw() + ylab("Interactions") + xlab("Difference between Bill and Corolla Length (cm)") + facet_wrap(~Hummingbird,scales="free",ncol=4)+ labs(fill="Model")  + ylab("Interactions per day") + scale_color_manual(values=c("red","blue")) + scale_fill_manual(values=c("red","blue"))
ggplot(data=spe[,],aes(x=trait)) + geom_point(data=indat,aes(x=Traitmatch,y=Yobs)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=Model),alpha=0.6)  + geom_line(aes(y=mean,col=Model),size=1) + theme_bw() + ylab("Interactions") + xlab("Difference between Bill and Corolla Length (cm)") + facet_wrap(~Hummingbird,scales="free",ncol=4)+ labs(fill="Model")  + ylab("Interactions per day") + scale_color_manual(values=c("purple","green")) + scale_fill_manual(values=c("purple","green"))
ggplot(data=spe[,],aes(x=trait)) + geom_point(data=indat,aes(x=Traitmatch,y=Yobs)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=Model),alpha=0.6)  + geom_line(aes(y=mean,col=Model),size=1) + theme_bw() + ylab("Interactions") + xlab("Difference between Bill and Corolla Length (cm)") + facet_wrap(~Hummingbird,scales="free",ncol=4)+ labs(fill="Model")  + ylab("Interactions per day") + scale_color_manual(values=c("purple","green")) + scale_fill_manual(values=c("purple","orange"))
ggplot(data=spe[,],aes(x=trait)) + geom_point(data=indat,aes(x=Traitmatch,y=Yobs)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=Model),alpha=0.6)  + geom_line(aes(y=mean,col=Model),size=1) + theme_bw() + ylab("Interactions") + xlab("Difference between Bill and Corolla Length (cm)") + facet_wrap(~Hummingbird,scales="free",ncol=4)+ labs(fill="Model")  + ylab("Interactions per day") + scale_color_manual(values=c("purple","orange")) + scale_fill_manual(values=c("purple","orange"))
ggsave("Figures/SpeciesPredictionsBoth.jpg",dpi=300,height=9,width=11)
ggplot(data=spe[,],aes(x=trait)) + geom_point(data=indat,aes(x=scaledR,y=Yobs)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=Model),alpha=0.6)  + geom_line(aes(y=mean,col=Model),size=1) + theme_bw() + ylab("Interactions") + xlab("Flowers (Hundreds)") + facet_wrap(~Hummingbird,scales="free",ncol=4)+ labs(fill="Model")  + ylab("Interactions per day") + scale_color_manual(values=c("grey70","black")) + scale_fill_manual(values=c("grey70","black"))
castdf<-dcast(pars_abundance[pars_abundance$par %in% c("beta1_mu","alpha_mu","tauE"),], Chain + Draw~par,value.var="estimate")
predy_abundance<-trajF(alpha=castdf$alpha_mu,beta1=castdf$beta1_mu,tauSigma=1/sqrt(castdf$tauE),trait=indat$scaledR)
aplot<-ggplot(data=predy_abundance,aes(x=trait)) + geom_ribbon(aes(ymin=lower,ymax=upper),alpha=0.5)  + geom_line(aes(y=mean),size=.4,linetype="dashed") + theme_bw() + ylab("Daily Interactions") + xlab("Hundreds of flowers") + geom_point(data=indat,aes(x=scaledR,y=Yobs),size=.5,alpha=.9) + ggtitle("Abundance")
aplot
ggsave("Figures/AbundanceBothPlot.jpeg",height=4,width=7,dpi=300)
castdf<-dcast(pars_abundance[pars_abundance$par %in% c("beta1","alpha"),], species +Chain +Model+ Draw~par,value.var="estimate")
tcastdf<-dcast(pars_abundance[pars_abundance$par %in% c("tauE"),],  Chain +Model+ Draw~par,value.var="estimate")
castdf<-merge(castdf,tcastdf,by=c("Chain","Model","Draw"))
#Turn to species level
castdf$species<-factor(castdf$species,levels=1:max(as.numeric(castdf$species)))
species.split<-split(castdf,list(castdf$species,castdf$Model))
species.traj<-list()
for(d in 1:length(species.split)){
x<-species.split[[d]]
#species name
index<-jagsIndexBird[unique(x$species),"Hummingbird"]
#range of trait distances
tsp<-indat %>% filter(Hummingbird==index) %>% .$scaledR
#Range of abundances
fsp<-indat %>% filter(Hummingbird==index) %>% .$scaledR
species.traj[[d]]<-trajF(alpha=x$alpha,beta1=x$beta1,tauSigma=1/sqrt(x$tauE),trait=tsp,resources=fsp)
}
names(species.traj)<-names(species.split)
species.traj<-melt(species.traj,id.var=colnames(species.traj[[1]]))
#split out names and model
species.traj[,c("Index","Model")]<-colsplit(species.traj$L1,"\\.",c("Index","Model"))
spe<-merge(species.traj,jagsIndexBird,by.x="Index",by.y="jBird")
#match colnames
#plot and compare to original data
ggplot(data=spe[,],aes(x=trait)) + geom_point(data=indat,aes(x=scaledR,y=Yobs)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=Model),alpha=0.6)  + geom_line(aes(y=mean,col=Model),size=1) + theme_bw() + ylab("Interactions") + xlab("Flowers (Hundreds)") + facet_wrap(~Hummingbird,scales="free",ncol=4)+ labs(fill="Model")  + ylab("Interactions per day") + scale_color_manual(values=c("grey70","black")) + scale_fill_manual(values=c("grey70","black"))
ggsave("Figures/SpeciesPredictions_Abundance.jpg",dpi=300,height=10,width=10)
ggplot(data=spe[,],aes(x=trait)) + geom_point(data=indat,aes(x=scaledR,y=Yobs)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=Model),alpha=0.6)  + geom_line(aes(y=mean,col=Model),size=1) + theme_bw() + ylab("Interactions") + xlab("Flowers (Hundreds)") + facet_wrap(~Hummingbird,scales="free",ncol=4)+ labs(fill="Model")  + ylab("Interactions per day") + scale_color_manual(values=c("Purple","black")) + scale_fill_manual(values=c("Purple","black"))
ggplot(data=spe[,],aes(x=trait)) + geom_point(data=indat,aes(x=scaledR,y=Yobs)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=Model),alpha=0.6)  + geom_line(aes(y=mean,col=Model),size=1) + theme_bw() + ylab("Interactions") + xlab("Flowers (Hundreds)") + facet_wrap(~Hummingbird,scales="free",ncol=4)+ labs(fill="Model")  + ylab("Interactions per day") + scale_color_manual(values=c("Purple","black")) + scale_fill_manual(values=c("Purple","black")) + theme(legend.position="bottom")
ggsave("Figures/SpeciesPredictions_Abundance.jpg",dpi=300,height=10,width=10)
disc_obs
disc_obs<-ggplot(fitstat,aes(x=fit,y=fitnew)) + geom_point(aes(col=Model)) + theme_bw() + labs(x="Discrepancy of observed data",y="Discrepancy of replicated data",col="Model")  + ggtitle("Empirical Data") + geom_abline() + coord_fixed() + ylim(ymin=ymin,ymax=ymax) + xlim(xmin=ymin,xmax=ymax)
disc_obs
ggplot(dmat,aes(x=Hummingbird,y=E,col=L1)) + geom_point(size=5,aes(shape=Significant)) + coord_flip() + labs(color="N-mixture Model",y="Mean Discrepancy") + scale_shape_manual("Significant Predictor",values=c(1,19)) + theme_bw()
library(reshape2)
library(foreach)
library(chron)
library(ggplot2)
library(knitr)
library(R2jags)
library(dplyr)
library(stringr)
library(gridExtra)
library(boot)
opts_chunk$set(message=FALSE,warning=FALSE,fig.width=5,fig.height=4,echo=TRUE,cache=F,fig.align='center',fig.path="figure/")
set.seed(3)
load("AbundanceSimulation.RData")
tplot<-ggplot(data=pm[,],aes(x=trait)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=L1),alpha=0.5)  + geom_line(aes(y=mean,group=L1),size=.4,linetype="dashed") + theme_bw() + ylab("Daily Interactions") + xlab("Difference between Bill and Corolla Length") + geom_point(data=mdat,aes(x=traitmatch,y=Interactions),size=.5,alpha=.5) + labs(fill="Model",col="") + ggtitle("Simulation: Traits") + scale_fill_manual(values=c("purple","orange"))+  geom_line(data=orig,aes(y=mean,col='True value'),size=.8)+ scale_color_manual(values="Black")
tplot
ggsave("Figures/SimPredictBoth.jpg",height=5,width=7)
library(reshape2)
library(chron)
library(ggplot2)
library(knitr)
library(R2jags)
library(dplyr)
library(stringr)
library(gridExtra)
library(boot)
library(bipartite)
opts_chunk$set(message=FALSE,warning=FALSE,fig.width=10,fig.height=7,echo=TRUE,cache=F,fig.align='center',fig.path="figureObserved/")
source("Bayesian/BayesFunctions.R")
load("Observed.Rdata")
ggplot(nstat,aes(x=value,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Metric,scales='free',nrow=2)  + scale_fill_manual("Model",values=c("black","grey70")) + theme_bw()
ggplot(nstat,aes(x=value,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Metric,scales='free',nrow=2)  + scale_fill_manual("Model",values=c("purple","orange")) + theme_bw()
ggsave("Figures/NetworkStats.jpeg",height = 5,width=6)
ggplot(data=spe[,],aes(x=trait))  + geom_ribbon(aes(ymin=lower,ymax=upper,fill=Model),alpha=0.6)  + geom_line(aes(y=mean,col=Model),size=1) + theme_bw() + ylab("Interactions") + xlab("Difference between Bill and Corolla Length (cm)") + facet_wrap(~Hummingbird,scales="free",ncol=4)+ labs(fill="Model")  + ylab("Interactions per day") + scale_color_manual(values=c("purple","orange")) + scale_fill_manual(values=c("purple","orange")) + geom_point(data=indat,aes(x=Traitmatch,y=Yobs))
ggsave("Figures/SpeciesPredictionsBoth.jpg",dpi=300,height=9,width=11)
castdf<-dcast(parsObs[parsObs$par %in% c("beta1","alpha"),], species +Chain +Model+ Draw~par,value.var="estimate")
tcastdf<-dcast(parsObs[parsObs$par %in% c("tauE"),],  Chain +Model+ Draw~par,value.var="estimate")
castdf<-merge(castdf,tcastdf,by=c("Chain","Model","Draw"))
#Turn to species level
castdf$species<-factor(castdf$species,levels=1:max(as.numeric(castdf$species)))
species.split<-split(castdf,list(castdf$species,castdf$Model),drop=T)
species.traj<-list()
for(d in 1:length(species.split)){
x<-species.split[[d]]
#species name
index<-jagsIndexBird[unique(x$species),"Hummingbird"]
#range of trait distances
tsp<-indat %>% filter(Hummingbird==index) %>% .$Traitmatch
#Range of abundances
fsp<-indat %>% filter(Hummingbird==index) %>% .$scaledR
species.traj[[d]]<-trajF(alpha=x$alpha,beta1=x$beta1,tauSigma=1/sqrt(x$tauE),trait=tsp,resources=fsp)
}
names(species.traj)<-names(species.split)
species.traj<-melt(species.traj,id.var=colnames(species.traj[[1]]))
#split out names and model
species.traj[,c("Index","Model")]<-colsplit(species.traj$L1,"\\.",c("Index","Model"))
spe<-merge(species.traj,jagsIndexBird,by.x="Index",by.y="jBird")
#match colnames
#plot and compare to original data
ggplot(data=spe[,],aes(x=trait))  + geom_ribbon(aes(ymin=lower,ymax=upper,fill=Model),alpha=0.6)  + geom_line(aes(y=mean,col=Model),size=1) + theme_bw() + ylab("Interactions") + xlab("Difference between Bill and Corolla Length (cm)") + facet_wrap(~Hummingbird,scales="free",ncol=4)+ labs(fill="Model")  + ylab("Interactions per day") + scale_color_manual(values=c("purple","orange")) + scale_fill_manual(values=c("purple","orange")) + geom_point(data=indat,aes(x=Traitmatch,y=Yobs))
ggsave("Figures/SpeciesPredictionsBoth.jpg",dpi=300,height=9,width=11)
ggsave("Figures/SpeciesPredictionsBoth.jpg",dpi=300,height=9,width=11)
castdf<-dcast(pars_abundance[pars_abundance$par %in% c("beta1","alpha"),], species +Chain +Model+ Draw~par,value.var="estimate")
tcastdf<-dcast(pars_abundance[pars_abundance$par %in% c("tauE"),],  Chain +Model+ Draw~par,value.var="estimate")
castdf<-merge(castdf,tcastdf,by=c("Chain","Model","Draw"))
#Turn to species level
castdf$species<-factor(castdf$species,levels=1:max(as.numeric(castdf$species)))
species.split<-split(castdf,list(castdf$species,castdf$Model))
species.traj<-list()
for(d in 1:length(species.split)){
x<-species.split[[d]]
#species name
index<-jagsIndexBird[unique(x$species),"Hummingbird"]
#range of trait distances
tsp<-indat %>% filter(Hummingbird==index) %>% .$scaledR
#Range of abundances
fsp<-indat %>% filter(Hummingbird==index) %>% .$scaledR
species.traj[[d]]<-trajF(alpha=x$alpha,beta1=x$beta1,tauSigma=1/sqrt(x$tauE),trait=tsp,resources=fsp)
}
names(species.traj)<-names(species.split)
species.traj<-melt(species.traj,id.var=colnames(species.traj[[1]]))
#split out names and model
species.traj[,c("Index","Model")]<-colsplit(species.traj$L1,"\\.",c("Index","Model"))
spe<-merge(species.traj,jagsIndexBird,by.x="Index",by.y="jBird")
#match colnames
#plot and compare to original data
ggplot(data=spe[,],aes(x=trait)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=Model),alpha=0.6)  + geom_line(aes(y=mean,col=Model),size=1) + theme_bw() + ylab("Interactions") + xlab("Flowers (Hundreds)") + facet_wrap(~Hummingbird,scales="free",ncol=4)+ labs(fill="Model")  + ylab("Interactions per day") + scale_color_manual(values=c("Purple","black")) + scale_fill_manual(values=c("Purple","black")) + theme(legend.position="bottom") + geom_point(data=indat,aes(x=scaledR,y=Yobs))
ggsave("Figures/SpeciesPredictions_Abundance.jpg",dpi=300,height=10,width=10)
library(reshape2)
library(chron)
library(ggplot2)
library(knitr)
library(R2jags)
library(dplyr)
library(stringr)
library(gridExtra)
library(boot)
library(bipartite)
opts_chunk$set(message=FALSE,warning=FALSE,fig.width=10,fig.height=7,echo=TRUE,cache=F,fig.align='center',fig.path="figureObserved/")
source("Bayesian/BayesFunctions.R")
load("Observed.Rdata")
ggplot(nstat,aes(x=value,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Metric,scales='free',nrow=2)  + scale_fill_manual("Model",values=c("purple","orange")) + theme_bw()
head)indat
head(indat)
indat %>% group_by(Hummingbird,Iplant_Double,DateP) %>% summarize(n=mean(Yobs))
indat %>% group_by(Hummingbird,Iplant_Double) %>% summarize(n=mean(Yobs))
mean_net<-indat %>% group_by(Hummingbird,Iplant_Double) %>% summarize(n=mean(Yobs))
acast(mean_net)
head(mean_net)
acast(mean_net,Hummingbird~Iplant_Double)
acast(mean_net,Hummingbird~Iplant_Double,fill=0)
mean_net<-acast(mean_net,Hummingbird~Iplant_Double,fill=0)
bipartite(mean_net,c("weighted_NODF","weighted connectange"))
bipartite(mean_net,c("weighted_NODF","weighted connectance"))
networklevel(mean_net,c("weighted_NODF","weighted connectance"))
networklevel(mean_net,c("NODF","weighted connectance"))
?networklevel
networklevel(mean_net,c("weighted NODF","weighted connectance"))
meanvals<-networklevel(mean_net,c("weighted NODF","weighted connectance"))
ggplot(nstat,aes(x=value,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Metric,scales='free',nrow=2)  + scale_fill_manual("Model",values=c("purple","orange")) + theme_bw()
head(nstat)
melt(meanvals)
names(Metric=names(meanvals),melt(meanvals))
meanvals
names(meanvals)
data.frame(Metric=names(meanvals),melt(meanvals))
meanvals<-data.frame(Metric=names(meanvals),melt(meanvals))
ggplot(nstat,aes(x=value,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Metric,scales='free',nrow=2)  + scale_fill_manual("Model",values=c("purple","orange")) + theme_bw() + gome_
ggplot(nstat,aes(x=value,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Metric,scales='free',nrow=2)  + scale_fill_manual("Model",values=c("purple","orange")) + theme_bw() + geom_vline(data=meanvals,linetype="dashed",aes(col="Mean Daily Interaction"))
ggplot(nstat,aes(x=value,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Metric,scales='free',nrow=2)  + scale_fill_manual("Model",values=c("purple","orange")) + theme_bw() + geom_vline(data=meanvals,linetype="dashed",aes(col="Mean Daily Interaction",x_intercept=value))
ggplot(nstat,aes(x=value,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Metric,scales='free',nrow=2)  + scale_fill_manual("Model",values=c("purple","orange")) + theme_bw() + geom_vline(data=meanvals,linetype="dashed",aes(col="Mean Daily Interaction",xintercept=value))
ggplot(nstat,aes(x=value,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Metric,scales='free',nrow=2)  + scale_fill_manual("Model",values=c("purple","orange")) + theme_bw() + geom_vline(data=meanvals,linetype="dashed",aes(col="Mean Daily Interaction",xintercept=value,size=10))
ggplot(nstat,aes(x=value,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Metric,scales='free',nrow=2)  + scale_fill_manual("Model",values=c("purple","orange")) + theme_bw() + geom_vline(data=meanvals,linetype="dashed",aes(col="Mean Daily Interaction",xintercept=value,size=2))
ggplot(nstat,aes(x=value,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Metric,scales='free',nrow=2)  + scale_fill_manual("Model",values=c("purple","orange")) + theme_bw() + geom_vline(data=meanvals,linetype="dashed",aes(col="Mean Daily Interaction",xintercept=value),size=1)
ggplot(nstat,aes(x=value,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Metric,scales='free',nrow=2)  + scale_fill_manual("Model",values=c("purple","orange")) + theme_bw() + geom_vline(data=meanvals,linetype="dashed",aes(col="Mean Daily Interaction",xintercept=value),size=1) + labs(col="")
ggplot(nstat,aes(x=value,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Metric,scales='free',nrow=2)  + scale_fill_manual("Model",values=c("purple","orange")) + theme_bw() + geom_vline(data=meanvals,linetype="dashed",aes(col="Mean Daily Matrix",xintercept=value),size=1) + labs(col="")
ggsave("Figures/NetworkStats_withbenchmark.jpeg",height = 5,width=6)
library(reshape2)
library(chron)
library(ggplot2)
library(knitr)
library(R2jags)
library(dplyr)
library(stringr)
library(gridExtra)
library(boot)
library(bipartite)
opts_chunk$set(message=FALSE,warning=FALSE,fig.width=10,fig.height=7,echo=TRUE,cache=F,fig.align='center',fig.path="figureObserved/")
source("Bayesian/BayesFunctions.R")
newModel<-F
load("Observed.Rdata")
fitstat %>% group_by(Model) %>% summarize(mean(fit),var(fit))
fitstat<-parsObs[parsObs$par %in% c("fit","fitnew"),]
fitstat<-dcast(fitstat,Model+Draw+Chain~par,value.var="estimate")
ymin<-min(c(fitstat$fit,fitstat$fitnew)) - min(c(fitstat$fit,fitstat$fitnew)) * .2
ymax<-max(c(fitstat$fit,fitstat$fitnew)) + max(c(fitstat$fit,fitstat$fitnew)) * .2
disc_obs<-ggplot(fitstat,aes(x=fit,y=fitnew)) + geom_point(aes(col=Model)) + theme_bw() + labs(x="Discrepancy of observed data",y="Discrepancy of replicated data",col="Model")  + ggtitle("Empirical Data") + geom_abline() + coord_fixed() + ylim(ymin=ymin,ymax=ymax) + xlim(xmin=ymin,xmax=ymax)
disc_obs
fitstat %>% group_by(Model) %>% summarize(mean(fit),var(fit))
ggsave("Figures/ObservedDiscrepancy.jpeg",width = 5,height=10)
ggplot(nstat,aes(x=value,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Metric,scales='free',nrow=2)  + scale_fill_manual("Model",values=c("purple","orange")) + theme_bw()
levels(nstat$Metric)
levels(nstat$Metric)<-c("Weighted NODF","Weighted Connectance")
ggplot(nstat,aes(x=value,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Metric,scales='free',nrow=2)  + scale_fill_manual("Model",values=c("purple","orange")) + theme_bw() + labs(x="Value",y="Density")
ggsave("Figures/NetworkStats.jpeg",height = 5,width=6)
ggsave("Figures/NetworkStats_withbenchmark.jpeg",height = 5,width=6)
ggplot(nstat,aes(x=value,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Metric,scales='free',nrow=2)  + scale_fill_manual("Model",values=c("purple","orange")) + theme_bw() + geom_vline(data=meanvals,linetype="dashed",aes(col="Mean Daily Matrix",xintercept=value),size=1) + labs(col="")
mean_net<-indat %>% group_by(Hummingbird,Iplant_Double) %>% summarize(n=mean(Yobs))
mean_net<-acast(mean_net,Hummingbird~Iplant_Double,fill=0)
meanvals<-networklevel(mean_net,c("weighted NODF","weighted connectance"))
meanvals<-data.frame(Metric=names(meanvals),melt(meanvals))
ggplot(nstat,aes(x=value,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Metric,scales='free',nrow=2)  + scale_fill_manual("Model",values=c("purple","orange")) + theme_bw() + geom_vline(data=meanvals,linetype="dashed",aes(col="Mean Daily Matrix",xintercept=value),size=1) + labs(col="") + labs(x="Value",y="Density")
ggsave("Figures/NetworkStats_withbenchmark.jpeg",height = 5,width=6)
mean_net<-indat %>% group_by(Hummingbird,Iplant_Double) %>% summarize(n=mean(Yobs))
mean_net<-acast(mean_net,Hummingbird~Iplant_Double,fill=0)
meanvals<-networklevel(mean_net,c("Weighted NODF","Weighted Connectance"))
meanvals<-data.frame(Metric=names(meanvals),melt(meanvals))
ggplot(nstat,aes(x=value,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Metric,scales='free',nrow=2)  + scale_fill_manual("Model",values=c("purple","orange")) + theme_bw() + geom_vline(data=meanvals,linetype="dashed",aes(col="Mean Daily Matrix",xintercept=value),size=1) + labs(col="") + labs(x="Value",y="Density")
ggsave("Figures/NetworkStats_withbenchmark.jpeg",height = 5,width=6)
levels(meanvals$Metric)
head(meanvals)
mean_net<-indat %>% group_by(Hummingbird,Iplant_Double) %>% summarize(n=mean(Yobs))
mean_net<-acast(mean_net,Hummingbird~Iplant_Double,fill=0)
meanvals<-networklevel(mean_net,c("weighted NODF","weighted connectance"))
meanvals
meanvals<-data.frame(Metric=names(meanvals),melt(meanvals))
meanvals
levels(meanvals$Metric)
levels(meanvals$Metric)<-c("Weighted Connectance","Weighted NODF")
ggplot(nstat,aes(x=value,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Metric,scales='free',nrow=2)  + scale_fill_manual("Model",values=c("purple","orange")) + theme_bw() + geom_vline(data=meanvals,linetype="dashed",aes(col="Mean Daily Matrix",xintercept=value),size=1) + labs(col="") + labs(x="Value",y="Density")
ggsave("Figures/NetworkStats_withbenchmark.jpeg",height = 5,width=6)
library(reshape2)
library(chron)
library(ggplot2)
library(knitr)
library(R2jags)
library(dplyr)
library(stringr)
library(gridExtra)
library(boot)
library(bipartite)
opts_chunk$set(message=FALSE,warning=FALSE,fig.width=10,fig.height=7,echo=TRUE,cache=F,fig.align='center',fig.path="figureObserved/")
source("Bayesian/BayesFunctions.R")
newModel<-F
load("Observed.Rdata")
ggplot(dmat,aes(x=Hummingbird,y=E,col=L1)) + geom_point(size=5,aes(shape=Significant),stroke=5) + coord_flip() + labs(color="N-mixture Model",y="Mean Discrepancy") + scale_shape_manual("Significant Predictor",values=c(1,19)) + theme_bw()
par_at<-list(Abundance=pars_abundance %>% filter(par=="E"),Trait=pars_detect_traits %>% filter(par=="E"))
par_at<-melt(par_at,id.vars=colnames(pars_detect_traits))
dmat<-par_at %>% group_by(species,L1) %>% summarize(E=mean(estimate))
dmat<-merge(dmat,jagsIndexBird,by.x="species",by.y="jBird")
#merge with range overlap
dmat<-merge(dmat,cz,by=c("L1","Hummingbird"))
#reorder
dmat$Hummingbird<-factor(dmat$Hummingbird,levels=rev(levels(dmat$Hummingbird)))
ggplot(dmat,aes(x=Hummingbird,y=E,col=L1)) + geom_point(size=5,aes(shape=Significant),stroke=5) + coord_flip() + labs(color="N-mixture Model",y="Mean Discrepancy") + scale_shape_manual("Significant Predictor",values=c(1,19)) + theme_bw()
ggsave("Figures/AverageBird.jpeg",dpi=600,height=5,width=8)
head(dmat)
cz
par_zero<-list(Abundance=pars_abundance %>% filter(par %in% c("beta1")),Trait=pars_detect_traits %>% filter(par %in% c("beta1")))
par_zero<-melt(par_zero,id.vars=colnames(pars_detect_traits))
cz<-par_zero %>% group_by(L1,species) %>% summarize(min=quantile(estimate,0.05),max=quantile(estimate,0.95),Significant=!findInterval(0,sort(c(min,max)))==1)
cz<-merge(cz,jagsIndexBird,by.x="species",by.y="jBird")
par_at<-list(Abundance=pars_abundance %>% filter(par=="E"),Trait=pars_detect_traits %>% filter(par=="E"))
par_at<-melt(par_at,id.vars=colnames(pars_detect_traits))
dmat<-par_at %>% group_by(species,L1) %>% summarize(E=mean(estimate))
dmat<-merge(dmat,jagsIndexBird,by.x="species",by.y="jBird")
dmat<-merge(dmat,cz,by=c("L1","Hummingbird"))
dmat$Hummingbird<-factor(dmat$Hummingbird,levels=rev(levels(dmat$Hummingbird)))
ggplot(dmat,aes(x=Hummingbird,y=E,col=L1)) + geom_point(size=5,aes(shape=Significant),stroke=5) + coord_flip() + labs(color="N-mixture Model",y="Mean Discrepancy") + scale_shape_manual("Significant Predictor",values=c(1,19)) + theme_bw()
ggplot(dmat,aes(x=Hummingbird,y=E,col=L1)) + geom_point(size=5,aes(shape=Significant),stroke=2) + coord_flip() + labs(color="N-mixture Model",y="Mean Discrepancy") + scale_shape_manual("Significant Predictor",values=c(1,19)) + theme_bw()
ggplot(dmat,aes(x=Hummingbird,y=E,col=L1)) + geom_point(size=5,aes(shape=Significant),stroke=2.5) + coord_flip() + labs(color="N-mixture Model",y="Mean Discrepancy") + scale_shape_manual("Significant Predictor",values=c(1,19)) + theme_bw() + scale_color_manual("grey30","black")
ggplot(dmat,aes(x=Hummingbird,y=E,col=L1)) + geom_point(size=5,aes(shape=Significant),stroke=2.5) + coord_flip() + labs(color="N-mixture Model",y="Mean Discrepancy") + scale_shape_manual("Significant Predictor",values=c(1,19)) + theme_bw() + scale_color_manual(values=c("grey30","black"))
ggplot(dmat,aes(x=Hummingbird,y=E,col=L1)) + geom_point(size=5,aes(shape=Significant),stroke=2.5) + coord_flip() + labs(color="N-mixture Model",y="Mean Discrepancy") + scale_shape_manual("Significant Predictor",values=c(1,19)) + theme_bw() + scale_color_manual(values=c("grey1`0","black"))
ggplot(dmat,aes(x=Hummingbird,y=E,col=L1)) + geom_point(size=5,aes(shape=Significant),stroke=2.5) + coord_flip() + labs(color="N-mixture Model",y="Mean Discrepancy") + scale_shape_manual("Significant Predictor",values=c(1,19)) + theme_bw() + scale_color_manual(values=c("grey10","black"))
ggplot(dmat,aes(x=Hummingbird,y=E,col=L1)) + geom_point(size=5,aes(shape=Significant),stroke=2.5) + coord_flip() + labs(color="N-mixture Model",y="Mean Discrepancy") + scale_shape_manual("Significant Predictor",values=c(1,19)) + theme_bw() + scale_color_manual(values=c("grey90","black"))
ggplot(dmat,aes(x=Hummingbird,y=E,col=L1)) + geom_point(size=5,aes(shape=Significant),stroke=2.5) + coord_flip() + labs(color="N-mixture Model",y="Mean Discrepancy") + scale_shape_manual("Significant Predictor",values=c(1,19)) + theme_bw() + scale_color_manual(values=c("grey70","black"))
ggsave("Figures/AverageBird.jpeg",dpi=600,height=5,width=8)
head(mdat)
head(indat)
indat %>% group_by(ID)
indat %>% group_by(ID) %>% summarize(mean(Day))
indat %>% group_by(ID) %>% summarize(max(Day))
a<-indat %>% group_by(ID) %>% summarize(max(Day))
a<-indat %>% group_by(ID) %>% summarize(n=max(Day))
a$n
mean(a$n)
a<-dath %>% group_by(ID) %>% summarize(n=max(Day))
a<-dath %>% group_by(ID) %>% summarize(n=length(unique(Date))
)
a
a$n
head(dath)
a<-dath %>% group_by(ID) %>% summarize(n=length(unique(DateP))
)
a
a$n
a$n
mean(a)
mean(a$n)
mean(a$n[-length(a)])
a
a %>% arrange(desc(n))
394 * 1.6
sum(a$n)
b=indat %>% group_by(ID) %>% summarize(n=max(Day))
b$n
sum(b$n)
unique(indat$DateP)
394 * 1.6
690 /12
690*12
690*10
load("AbundanceSimulation.RData")
tplot<-ggplot(data=pm[,],aes(x=trait)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=L1),alpha=0.5)  + geom_line(aes(y=mean,group=L1),size=.4,linetype="dashed") + theme_bw() + ylab("Daily Interactions") + xlab("Difference between Bill and Corolla Length") + geom_point(data=mdat,aes(x=traitmatch,y=Interactions),size=.5,alpha=.5) + labs(fill="Model",col="") + ggtitle("Simulation: Traits") + scale_fill_manual(values=c("purple","orange"))+  geom_line(data=orig,aes(y=mean,col='True value'),size=.8)+ scale_color_manual(values="Black")
library(reshape2)
library(foreach)
library(chron)
library(ggplot2)
library(knitr)
library(dplyr)
library(R2jags)
library(stringr)
library(gridExtra)
library(boot)
tplot<-ggplot(data=pm[,],aes(x=trait)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=L1),alpha=0.5)  + geom_line(aes(y=mean,group=L1),size=.4,linetype="dashed") + theme_bw() + ylab("Daily Interactions") + xlab("Difference between Bill and Corolla Length") + geom_point(data=mdat,aes(x=traitmatch,y=Interactions),size=.5,alpha=.5) + labs(fill="Model",col="") + ggtitle("Simulation: Traits") + scale_fill_manual(values=c("purple","orange"))+  geom_line(data=orig,aes(y=mean,col='True value'),size=.8)+ scale_color_manual(values="Black")
tplot
?geom-jitter
?geom_jitter
tplot<-ggplot(data=pm[,],aes(x=trait)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=L1),alpha=0.5)  + geom_line(aes(y=mean,group=L1),size=.4,linetype="dashed") + theme_bw() + ylab("Daily Interactions") + xlab("Difference between Bill and Corolla Length") + geom_jitter(data=mdat,aes(x=traitmatch,y=Interactions),size=.5,alpha=.5) + labs(fill="Model",col="") + ggtitle("Simulation: Traits") + scale_fill_manual(values=c("purple","orange"))+  geom_line(data=orig,aes(y=mean,col='True value'),size=.8)+ scale_color_manual(values="Black")
tplot
tplot<-ggplot(data=pm[,],aes(x=trait)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=L1),alpha=0.5)  + geom_line(aes(y=mean,group=L1),size=.4,linetype="dashed") + theme_bw() + ylab("Daily Interactions") + xlab("Difference between Bill and Corolla Length") + geom_jitter(data=mdat,aes(x=traitmatch,y=Interactions),size=.6,alpha=.7,width=0.05,height=0) + labs(fill="Model",col="") + ggtitle("Simulation: Traits") + scale_fill_manual(values=c("purple","orange"))+  geom_line(data=orig,aes(y=mean,col='True value'),size=.8)+ scale_color_manual(values="Black")
tplot
tplot<-ggplot(data=pm[,],aes(x=trait)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=L1),alpha=0.5)  + geom_line(aes(y=mean,group=L1),size=.4,linetype="dashed") + theme_bw() + ylab("Daily Interactions") + xlab("Difference between Bill and Corolla Length") + geom_jitter(data=mdat,aes(x=traitmatch,y=Interactions),size=.6,alpha=.7,width=0.01,height=0) + labs(fill="Model",col="") + ggtitle("Simulation: Traits") + scale_fill_manual(values=c("purple","orange"))+  geom_line(data=orig,aes(y=mean,col='True value'),size=.8)+ scale_color_manual(values="Black")
tplot
tplot<-ggplot(data=pm[,],aes(x=trait)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=L1),alpha=0.5)  + geom_line(aes(y=mean,group=L1),size=.4,linetype="dashed") + theme_bw() + ylab("Daily Interactions") + xlab("Difference between Bill and Corolla Length") + geom_jitter(data=mdat,aes(x=traitmatch,y=Interactions),size=.6,alpha=.7,width=0.03,height=0) + labs(fill="Model",col="") + ggtitle("Simulation: Traits") + scale_fill_manual(values=c("purple","orange"))+  geom_line(data=orig,aes(y=mean,col='True value'),size=.8)+ scale_color_manual(values="Black")
tplot
ggsave("Figures/SimPredictBoth.jpg",height=5,width=7)
getwd()
tplot<-ggplot(data=pm[,],aes(x=trait)) + geom_ribbon(aes(ymin=lower,ymax=upper,fill=L1),alpha=0.5)  + geom_line(aes(y=mean,group=L1),size=.4,linetype="dashed") + theme_bw() + ylab("Daily Interactions") + xlab("Difference between Bill and Corolla Length") + geom_jitter(data=mdat,aes(x=traitmatch,y=Interactions),size=.5,alpha=.7,width=0.03,height=0) + labs(fill="Model",col="") + ggtitle("Simulation: Traits") + scale_fill_manual(values=c("purple","orange"))+  geom_line(data=orig,aes(y=mean,col='True value'),size=.8)+ scale_color_manual(values="Black")
tplot
ggsave("Figures/SimPredictBoth.jpg",height=5,width=7)
logit(-1)
library(boot)
logit(0.5)
logit(0)
logit(-1)
inv.logit(-1)
inv.logit(0)
